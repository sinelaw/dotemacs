#!/usr/bin/env python

import os
import sys

def main():
    p = sys.argv[1]
    po = ""
    if len(sys.argv[2:]):
        po = sys.argv[2:]
        assert(len(po) == 1)
    found = False
    f = os.path.basename(p)
    d = os.path.dirname(p)
    while True:
        prev_d = d
        if os.path.exists(os.path.join(d, "Makefile")):
            found = True
            break
        f = os.path.join(os.path.basename(d), f)
        d = os.path.dirname(d)
        if prev_d == d:
            break
    if not found:
        return

    cmd = "make -C %s GCC_COLORS= check-syntax CHK_SOURCES=%s CHK_SOURCES_ORIGINAL=%s 2>&1" % (d, f, po[0])
    for line in os.popen(cmd):
        if line.startswith(f):
            line = p + line[len(f):]
        print line,

main()

